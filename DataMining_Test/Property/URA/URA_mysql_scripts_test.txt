================================================================================
Find: 2020 Price is lower than 2019 price, more than 5%, price less than 850,000
Find: 2020 Price is higher than 2019 price more than 5%, price less than 1,000,000
------------------------------------------------------------
CREATE VIEW URA_CONDOEC_TRANS_AVG
AS
SELECT POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, SALE_TYPE, TENURE_YEAR, SALE_YEAR, FLOOR_AREA_LOWER, CAST(ROUND(AVG(PRICE)) AS INTEGER) AS PRICE_AVG
FROM URA_CONDOEC_TRANS_HIST
GROUP BY POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, SALE_TYPE, TENURE_YEAR, SALE_YEAR, FLOOR_AREA_LOWER;
------------------------------------------------------------
SELECT a.POSTAL_DISTRICT, a.PROJECT_NAME, a.STREET_NAME, a.PROPERTY_TYPE, a.SALE_TYPE, a.TENURE_YEAR, a.FLOOR_AREA_LOWER, a.SALE_YEAR, a.PRICE_AVG, b.SALE_YEAR, b.PRICE_AVG,
CAST(((b.PRICE_AVG - a.PRICE_AVG) * 100 / a.PRICE_AVG) AS FLOAT) AS DECREASE_PERCENT
FROM
  URA_CONDOEC_TRANS_AVG a
  INNER JOIN
  URA_CONDOEC_TRANS_AVG b
  ON ((a.POSTAL_DISTRICT = b.POSTAL_DISTRICT)
      AND (a.PROJECT_NAME = b.PROJECT_NAME)
      AND (a.FLOOR_AREA_LOWER >= 80)
      AND (a.FLOOR_AREA_LOWER = b.FLOOR_AREA_LOWER)
      AND (a.SALE_YEAR > 2018)
      AND (a.SALE_YEAR < b.SALE_YEAR)
      AND (a.PRICE_AVG > b.PRICE_AVG)
      AND (b.PRICE_AVG <= 850000))
WHERE (CAST(((b.PRICE_AVG - a.PRICE_AVG) * 100 / a.PRICE_AVG) AS FLOAT) <= -5.0)
ORDER BY a.POSTAL_DISTRICT, a.PROJECT_NAME, a.FLOOR_AREA_LOWER;
------------------------------------------------------------
SELECT a.POSTAL_DISTRICT, a.PROJECT_NAME, a.STREET_NAME, a.PROPERTY_TYPE, a.SALE_TYPE, a.TENURE_YEAR, a.FLOOR_AREA_LOWER, a.SALE_YEAR, a.PRICE_AVG, b.SALE_YEAR, b.PRICE_AVG,
CAST(((b.PRICE_AVG - a.PRICE_AVG) * 100 / a.PRICE_AVG) AS FLOAT) AS DECREASE_PERCENT
FROM
  URA_CONDOEC_TRANS_AVG a
  INNER JOIN
  URA_CONDOEC_TRANS_AVG b
  ON ((a.POSTAL_DISTRICT = b.POSTAL_DISTRICT)
      AND (a.PROJECT_NAME = b.PROJECT_NAME)
      AND (a.FLOOR_AREA_LOWER >= 80)
      AND (a.FLOOR_AREA_LOWER = b.FLOOR_AREA_LOWER)
      AND (a.SALE_YEAR > 2018)
      AND (a.SALE_YEAR < b.SALE_YEAR)
      AND (a.PRICE_AVG <= b.PRICE_AVG)
      AND (b.PRICE_AVG <= 1000000))
WHERE (CAST(((b.PRICE_AVG - a.PRICE_AVG) * 100 / a.PRICE_AVG) AS FLOAT) >= 5.0)
ORDER BY a.POSTAL_DISTRICT, a.PROJECT_NAME, a.FLOOR_AREA_LOWER;
================================================================================
Find: No rent house
------------------------------------------------------------
SELECT a.POSTAL_DISTRICT, a.PROJECT_NAME, a.STREET_NAME, a.PROPERTY_TYPE, a.SALE_TYPE, a.TENURE_YEAR, a.SALE_YEAR, a.FLOOR_AREA_LOWER, a.PRICE_AVG
FROM
  (SELECT POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, SALE_TYPE, TENURE_YEAR, SALE_YEAR, FLOOR_AREA_LOWER, CAST(ROUND(AVG(PRICE)) AS INTEGER) AS PRICE_AVG
   FROM URA_CONDOEC_TRANS_HIST
   GROUP BY POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, SALE_TYPE, TENURE_YEAR, SALE_YEAR, FLOOR_AREA_LOWER) a
  LEFT JOIN
  (SELECT POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, LEASE_YEAR, FLOOR_AREA_LOWER, CAST(ROUND(AVG(YEARLY_GROSS_RENT)) AS INTEGER) AS YEARLY_GROSS_RENT_AVG
   FROM URA_CONDOEC_RENT_HIST
   GROUP BY POSTAL_DISTRICT, PROJECT_NAME, STREET_NAME, PROPERTY_TYPE, LEASE_YEAR, FLOOR_AREA_LOWER) b
  ON ((a.POSTAL_DISTRICT = b.POSTAL_DISTRICT)
      AND (a.PROJECT_NAME = b.PROJECT_NAME)
      AND (a.SALE_YEAR = b.LEASE_YEAR)
      AND (a.FLOOR_AREA_LOWER = b.FLOOR_AREA_LOWER)
      AND (b.YEARLY_GROSS_RENT_AVG IS NULL))
ORDER BY a.POSTAL_DISTRICT, a.PROJECT_NAME, a.FLOOR_AREA_LOWER;
================================================================================
